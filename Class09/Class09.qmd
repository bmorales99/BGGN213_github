---
title: "Class09"
author: "Bobbie Morales A15443382"
format: pdf
---

## The PDB database 

The main repository for biomolecular structure data is the Protein Data Bank (PDB): https://www.rcsb.org

Let's have a quick look at the composition of the database: 

>Q1: What percentage of structures in the PDB are solved by X-Ray and Electron Microscopy.

81% are solved by X-ray while 12.27 are solved by electron microscopy

```{r}

stats <- read.csv("Data Export Summary.csv")
stats

```

```{r}
as.numeric( sub(",", "", stats$X.ray))
```
This is annoying, let's try a different import function from the "readr" packafe

```{r}
library(readr)

stats <- read_csv("Data Export Summary.csv")
stats
```
Percent Xray
```{r}
n.total <- sum(stats$Total)
n.xray <- sum(stats$`X-ray`)
round(n.xray/n.total * 100, 2)
```

```{r}
n.total <- sum(stats$Total)
n.EM <- sum(stats$EM)
round(n.EM/n.total * 100, 2)
```
>Q2: What proportion of structures in the PDB are protein?

```{r}
stats$Total[1]/n.total
```
0.860465 are PDB protein


```{r}
library(ggplot2)
ggplot(stats, aes(reorder(`Molecular Type`, Total), Total)) + 
  geom_col()
```

## Visualizing Structure Data 

The Mol* viewer is embedded in many bioinformatics websites. The homepage is https://molstar.org/viewer/

I can insert any figure or image file using markdown format

![The HIV-Rr dimer with bound inhbition](1HSG.png)

![](1HSG (1).png)

>Q4 Water molecules normally have 3 atoms. Why do we see just one atom per water molecule in this structure?

The hydrogen has low resolution when viewed by x-ray. PDB entries typically only contain coordinates for heavier atoms and the hydrogens are added computationally later.

>Q3: Type HIV in the PDB website search box on the home page and determine how many HIV-1 protease structures are in the current PDB?

There are 1150 HIV-1 protease strucures in the current PDB.

>Q5: There is a critical “conserved” water molecule in the binding site. Can you identify this water molecule? What residue number does this water molecule have

The criticially conserved water molecule is residue number 308. See second image above.

>Q6: Generate and save a figure clearly showing the two distinct chains of HIV-protease along with the ligand. You might also consider showing the catalytic residues ASP 25 in each chain and the critical water (we recommend “Ball & Stick” for these side-chains). Add this figure to your Quarto document.


## Bio3D package for structural bioinformatics 

We can use the bio3s package to read and analyze biomolecular data in R: 

```{r}
library(bio3d)

hiv <- read.pdb("1hsg")
hiv
```

```{r}
head(hiv$atom)
```

Let's get the sequence

```{r}
pdbseq(hiv)
```

Let's trim to chain A and just it's sequence: 

```{r}
chainA <- trim.pdb(hiv, chain= "A")
chainA.seq <- pdbseq(chainA)
```

Let's blast

```{r, blast_hiv, cache=TRUE}
blast <- blast.pdb(chainA.seq)
```

```{r}
head(blast$hit.tbl)
```

plot a quick overview of blast results 

```{r}
hits <- plot(blast)
```


```{r}
hits$pdb.id
```
>Q7: How many amino acid residues are there in this pdb object? 

There are 198 amino acid residues

>Q8: Name one of the two non-protein residues? 

One of the 2 non protein residues is water

>Q9: How many protein chains are in this structure?

There are 2 protein chains

## Prediction of functional motions 

We can run a Normal Mode Analysis (NMA) to predict large scale motions/flexibility/dynamics of any biomolecule that we can read into R.

Let's look at ADK

```{r}
adk <- read.pdb("1ake")
adk_A <- trim.pdb(adk, chain = "A")
adk_A
```
```{r}
m <- nma(adk_A)
plot(m)
```

Let's write out a "trajectory" of predicted motion 

```{r}
mktrj(m, file= "adk_nma.pdb")
```

## Play with 3D viewing in R

we can use the new **bio3dview** package, which is not yet on CRAN, to render interactive 3D views in R and HTML, quarto output reports 

To install from github we can use the **pak** package

```{r}
library(bio3dview)

#view.pdb(adk)
```

## Comparative analysis of protein structures

starting with a sequence or strcuture ID (accession number) let's run a complete analysis pipeline.

```{r}
library(bio3d)
id <- "1ake_A"
aa <- get.seq(id)
aa
```

```{r, cache=TRUE}
blast <- blast.pdb(aa)
hits <- plot(blast)
```


```{r}
hits$pdb.id
```
Download all these " hits" that are similar to our starting id sequence
```{r}
files <- get.pdb(hits$pdb.id, path="pdbs", split=TRUE, gzip=TRUE )
```

```{r}
library(BiocManager)
pdbs <- pdbaln(files, fit = TRUE, exefile="msa")
```

```{r}
pc.xray <- pca(pdbs)
plot(pc.xray)
```

```{r}
plot(pc.xray,1:2)
```

```{r}
mktrj(pc.xray, file ="pca_results.pdb")
```

```{r}
library(bio3dview)

view.pca(pc.xray)
```

